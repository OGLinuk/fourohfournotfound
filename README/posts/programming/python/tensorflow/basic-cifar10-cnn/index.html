<!DOCTYPE HTML>
<html lang="en">

	<head>
		<title>Basic CIFAR-10 CNN</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width" , initial-scale="1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie-edge" />
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<link rel="shortcut icon" href="/static/images/icon.png" type="image/png" />
		<link rel="stylesheet" href="/static/style.css" />
		<link rel="stylesheet" href="/static/reset.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script> 
	</head>

	<body class="body">
		<header class=nav-bar>
			<nav class="navbar navbar-expand-sm bg-light justify-content-center">
				<ul class="nav">
					<li class="nav-item">
						<a class="nav-link" href="/">Home</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/posts">Posts</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/books">Library</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/tbl">The Big List</a>
					</li>
				</ul>
			</nav>
		</header>
		<h1>Basic CIFAR-10 CNN</h1>
		
		<br>

		<main>
			<p>This blog is going to cover the <a href="https://www.tensorflow.org/tutorials/images/cnn">convolutional neural network</a> (CNN) tutorial provided by Tensorflow. The CNN is going to be used to classify <a href="https://www.cs.toronto.edu/%7Ekriz/cifar.html">CIFAR-10</a> images, which is a dataset consisting of 10 classes: airplane, automobile, bird, cat, deer, dog, frog, horse, ship, and truck. There are 60000 (32x32 color) images, 6000 for each class, 50000 training images, and 10000 test images.</p>
<p>You will need the following dependencies installed:</p>
<ul>
<li>Tensorflow</li>
<li>Matplotlib</li>
</ul>
<p>As always, let’s start by building the base of our class.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="im">import</span> tensorflow <span class="im">as</span> tf</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="im">from</span> tensorflow.keras <span class="im">import</span> datasets, layers, models</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">class</span> CifarCNN(<span class="bu">object</span>):</a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-7" title="7">        <span class="va">self</span>.classes <span class="op">=</span> [<span class="st">&#39;airplane&#39;</span>, <span class="st">&#39;automobile&#39;</span>, <span class="st">&#39;bird&#39;</span>, <span class="st">&#39;cat&#39;</span>, <span class="st">&#39;deer&#39;</span>, <span class="st">&#39;dog&#39;</span>, <span class="st">&#39;frog&#39;</span>, <span class="st">&#39;horse&#39;</span>, <span class="st">&#39;ship&#39;</span>, <span class="st">&#39;truck&#39;</span>]        </a>
<a class="sourceLine" id="cb1-8" title="8">        (<span class="va">self</span>.train_imgs, <span class="va">self</span>.train_labels), (<span class="va">self</span>.test_imgs, <span class="va">self</span>.test_labels) <span class="op">=</span> datasets.cifar10.load_data()</a></code></pre></div>
<p>No need for an <code>obtain_data</code> method, since <a href="https://www.tensorflow.org/api_docs/python/tf/keras/datasets">tensorflow.keras.datasets</a> provides a <code>cifar10</code> module, which returns a tuple of numpy arrays <code>(x_train, y_train), (x_test, y_test)</code>. Since we are only working with 10 classes, I am going to leave the hard coded <code>self.classes</code> value.</p>
<p>The first method we are going to add is <code>explore_data</code>. I diverged a bit from the tutorial, mostly because I want to get into a good habit of what I should be exploring when it comes to the data (especially with data that isn’t already prepared).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1">    <span class="kw">def</span> explore_data(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-2" title="2">        <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.train_imgs)<span class="sc">}</span><span class="ss"> training examples ...&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">        <span class="bu">print</span>(<span class="ss">f&#39;Training image shape: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>train_imgs[<span class="dv">0</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb2-4" title="4">        <span class="bu">print</span>(<span class="ss">f&#39;Training labels: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>train_labels<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">        <span class="bu">print</span>(<span class="ss">f&#39;Training labels type: </span><span class="sc">{</span><span class="bu">type</span>(<span class="va">self</span>.train_labels)<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb2-6" title="6">        </a>
<a class="sourceLine" id="cb2-7" title="7">        <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.test_imgs)<span class="sc">}</span><span class="ss"> test examples ...&#39;</span>)</a>
<a class="sourceLine" id="cb2-8" title="8">        <span class="bu">print</span>(<span class="ss">f&#39;Test image shape: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>test_imgs[<span class="dv">0</span>]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb2-9" title="9">        <span class="bu">print</span>(<span class="ss">f&#39;Test labels: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>test_labels<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb2-10" title="10">        <span class="bu">print</span>(<span class="ss">f&#39;Test labels type: </span><span class="sc">{</span><span class="bu">type</span>(<span class="va">self</span>.test_labels)<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb2-11" title="11">        </a>
<a class="sourceLine" id="cb2-12" title="12">        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb2-13" title="13">        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">25</span>):</a>
<a class="sourceLine" id="cb2-14" title="14">            plt.subplot(<span class="dv">5</span>, <span class="dv">5</span>, i<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-15" title="15">            plt.xticks([])</a>
<a class="sourceLine" id="cb2-16" title="16">            plt.yticks([])</a>
<a class="sourceLine" id="cb2-17" title="17">            plt.grid(<span class="va">False</span>)</a>
<a class="sourceLine" id="cb2-18" title="18">            plt.imshow(<span class="va">self</span>.train_imgs[i], cmap<span class="op">=</span>plt.cm.binary)</a>
<a class="sourceLine" id="cb2-19" title="19">            plt.xlabel(<span class="va">self</span>.classes[<span class="va">self</span>.train_labels[i][<span class="dv">0</span>]])</a>
<a class="sourceLine" id="cb2-20" title="20">        plt.show()</a></code></pre></div>
<p>The first thing we do in this method is inspect the number of training/test examples, the shape of the training/test example images, the training/test labels, and the datatype used for the training/test labels. The reason for checking the datatype is the same reason as above, to get into a habit of understanding what I am working with. After inspecting the images and labels, we visualize 25 of the training images with their corresponding labels.</p>
<p>The output:</p>
<pre><code>50000 training examples ...
Train image shape: (32, 32, 3)
Train labels: [[6]
 [9]
 [9]
 ...
 [9]
 [1]
 [1]]
Training labels type: &lt;class &#39;numpy.ndarray&#39;&gt;

10000 test examples ...
Test image shape: (32, 32, 3)
Test labels: [[3]
 [8]
 [8]
 ...
 [5]
 [1]
 [7]]
Test labels type: &lt;class &#39;numpy.ndarray&#39;&gt;</code></pre>
<p><img src="25-train-images.png" /></p>
<p><br />
</p>
<p>The next method we are adding is <code>preprocess_data</code>. In this method we are just normalizing the images from a <code>[0, 255]</code> range to a <code>[0, 1]</code> range. I added an extra step, which is to visualize the first training image, to ensure that the images were normalized properly.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1">    <span class="kw">def</span> preprocess_data(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb4-2" title="2">        <span class="va">self</span>.train_imgs <span class="op">=</span> <span class="va">self</span>.train_imgs <span class="op">/</span> <span class="fl">255.0</span></a>
<a class="sourceLine" id="cb4-3" title="3">        <span class="va">self</span>.test_imgs <span class="op">=</span> <span class="va">self</span>.test_imgs <span class="op">/</span> <span class="fl">255.0</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5">        plt.figure()</a>
<a class="sourceLine" id="cb4-6" title="6">        plt.title(<span class="ss">f&#39;</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>classes[<span class="va">self</span>.train_labels[<span class="dv">0</span>][<span class="dv">0</span>]]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>train_labels[<span class="dv">0</span>][<span class="dv">0</span>]<span class="sc">}</span><span class="ss">)&#39;</span>)</a>
<a class="sourceLine" id="cb4-7" title="7">        plt.imshow(<span class="va">self</span>.train_imgs[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb4-8" title="8">        plt.colorbar()</a>
<a class="sourceLine" id="cb4-9" title="9">        plt.grid(<span class="va">False</span>)</a>
<a class="sourceLine" id="cb4-10" title="10">        plt.show()</a></code></pre></div>
<p>The output:</p>
<p><img src="normalized.png" /></p>
<p><br />
</p>
<p>Next, to add the <code>build_model</code> method.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1">    <span class="kw">def</span> build_model(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb5-2" title="2">        model <span class="op">=</span> models.Sequential([</a>
<a class="sourceLine" id="cb5-3" title="3">            layers.Conv2D(<span class="dv">32</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>, input_shape<span class="op">=</span>(<span class="dv">32</span>, <span class="dv">32</span>, <span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb5-4" title="4">            layers.MaxPool2D((<span class="dv">2</span>, <span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb5-5" title="5">            layers.Conv2D(<span class="dv">64</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>),</a>
<a class="sourceLine" id="cb5-6" title="6">            layers.MaxPool2D((<span class="dv">2</span>, <span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb5-7" title="7">            layers.Conv2D(<span class="dv">64</span>, (<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>),</a>
<a class="sourceLine" id="cb5-8" title="8">            layers.Flatten(),</a>
<a class="sourceLine" id="cb5-9" title="9">            layers.Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>),</a>
<a class="sourceLine" id="cb5-10" title="10">            layers.Dense(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb5-11" title="11">        ])</a>
<a class="sourceLine" id="cb5-12" title="12"></a>
<a class="sourceLine" id="cb5-13" title="13">        model.summary()</a>
<a class="sourceLine" id="cb5-14" title="14"></a>
<a class="sourceLine" id="cb5-15" title="15">        model.<span class="bu">compile</span>(</a>
<a class="sourceLine" id="cb5-16" title="16">            optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>,</a>
<a class="sourceLine" id="cb5-17" title="17">            loss<span class="op">=</span>tf.keras.losses.SparseCategoricalCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),</a>
<a class="sourceLine" id="cb5-18" title="18">            metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>]</a>
<a class="sourceLine" id="cb5-19" title="19">        )</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21">        <span class="cf">return</span> model</a></code></pre></div>
<p>The model we are building consists of seven layers. The first layer is a <code>Conv2D</code> layer with 32 filters, a 3x3 kernel size, ReLU for the activation function, and defining the input shape as a 32x32 image with 3 channels (RGB). I found a really good gif that visually describes what a 2D convolution looks like.</p>
<p><img src="convolution.gif" /></p>
<p><a href="https://stackoverflow.com/a/50317223">[source]</a></p>
<p>The second layers is a <code>MaxPool2D</code> layer with a pool size of 2x2. Max-pooling just down-samples an input. The following is a nice visual of that process and what a real example would look like.</p>
<p><img src="2x2-maxpool.png" /></p>
<p><img src="real-2x2-maxpool.png" /></p>
<p><a href="https://computersciencewiki.org/index.php/Max-pooling_/_Pooling">[source]</a></p>
<p>The third and fifth layers are the same as the first, except for the filters being 64 rather than 32, and specification of an input shape (which is only needed for the first layer). The fourth layer is the same as the second. The sixth layer (<code>Flatten</code>), transforms the three-dimensional array to a one-dimensional one, since dense layers take vectors as inputs (one-dimensional arrays). The seventh layer is a <code>Dense</code> layer that has 64 units (neurons), and uses ReLU as the activation function. The eighth and final layer is another dense layer that has 10 units (one unit for each of the 10 CIFAR classes).</p>
<p>The model summary:</p>
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
conv2d (Conv2D)              (None, 30, 30, 32)        896
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 15, 15, 32)        0
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 13, 13, 64)        18496
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 6, 6, 64)          0
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 4, 4, 64)          36928
_________________________________________________________________
flatten (Flatten)            (None, 1024)              0
_________________________________________________________________
dense (Dense)                (None, 64)                65600
_________________________________________________________________
dense_1 (Dense)              (None, 10)                650
=================================================================
Total params: 122,570
Trainable params: 122,570
Non-trainable params: 0</code></pre>
<p>The last operation performed in this method is <code>model.compile</code>. For the optimizer we are using adam, for the loss we are using <a href="https://www.tensorflow.org/api_docs/python/tf/keras/losses/SparseCategoricalCrossentropy">SparseCategoricalCrossentropy</a>, and for the metrics we are using accuracy. For a more in-depth explanation of what those are please refer to my <a href="/programming/python/tensorflow/basic-image-classification">basic image classification blog</a>.</p>
<p><br />
</p>
<p>The next method is <code>train_model</code>. Not much happening in this method, just using the <code>fit()</code> method to train the model on our training images, for the value of <code>self.epochs</code>, and using the test images/labels to evaluate the loss and accuracy of the model.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1">    <span class="kw">def</span> train_model(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb7-2" title="2">        <span class="cf">return</span> <span class="va">self</span>.model.fit(</a>
<a class="sourceLine" id="cb7-3" title="3">            <span class="va">self</span>.train_imgs,</a>
<a class="sourceLine" id="cb7-4" title="4">            <span class="va">self</span>.train_labels,</a>
<a class="sourceLine" id="cb7-5" title="5">            epochs<span class="op">=</span><span class="va">self</span>.epochs,</a>
<a class="sourceLine" id="cb7-6" title="6">            validation_data<span class="op">=</span>(<span class="va">self</span>.test_imgs, <span class="va">self</span>.test_labels)</a>
<a class="sourceLine" id="cb7-7" title="7">        )</a></code></pre></div>
<p>The output:</p>
<pre><code>Epoch 1/10
1563/1563 [==============================] - 36s 23ms/step - loss: 1.5464 - accuracy: 0.4367 - val_loss: 1.3381 - val_accuracy: 0.5181
Epoch 2/10
1563/1563 [==============================] - 34s 22ms/step - loss: 1.1933 - accuracy: 0.5754 - val_loss: 1.1025 - val_accuracy: 0.6065
Epoch 3/10
1563/1563 [==============================] - 34s 22ms/step - loss: 1.0338 - accuracy: 0.6354 - val_loss: 0.9951 - val_accuracy: 0.6444
Epoch 4/10
1563/1563 [==============================] - 34s 22ms/step - loss: 0.9402 - accuracy: 0.6699 - val_loss: 0.9401 - val_accuracy: 0.6669
Epoch 5/10
1563/1563 [==============================] - 34s 22ms/step - loss: 0.8648 - accuracy: 0.6964 - val_loss: 0.9229 - val_accuracy: 0.6699
Epoch 6/10
1563/1563 [==============================] - 34s 22ms/step - loss: 0.8076 - accuracy: 0.7154 - val_loss: 0.8983 - val_accuracy: 0.6958
Epoch 7/10
1563/1563 [==============================] - 34s 22ms/step - loss: 0.7651 - accuracy: 0.7338 - val_loss: 0.8623 - val_accuracy: 0.7026
Epoch 8/10
1563/1563 [==============================] - 34s 22ms/step - loss: 0.7223 - accuracy: 0.7475 - val_loss: 0.8618 - val_accuracy: 0.7017
Epoch 9/10
1563/1563 [==============================] - 34s 22ms/step - loss: 0.6865 - accuracy: 0.7571 - val_loss: 0.8845 - val_accuracy: 0.6932
Epoch 10/10
1563/1563 [==============================] - 34s 22ms/step - loss: 0.6526 - accuracy: 0.7720 - val_loss: 0.8662 - val_accuracy: 0.7080
313/313 - 2s - loss: 0.8662 - accuracy: 0.7080</code></pre>
<p><br />
</p>
<p>From <code>train_model</code> we are returning the history object, which we will be using in the next method: <code>evaluate_model</code>. This method is checking the loss and accuracy returned from <code>evaluate()</code>, then we are plotting the accuracy and validation accuracy values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" title="1">    <span class="kw">def</span> evaluate_model(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb9-2" title="2">        test_loss, test_acc <span class="op">=</span> <span class="va">self</span>.model.evaluate(<span class="va">self</span>.test_imgs, <span class="va">self</span>.test_labels, verbose<span class="op">=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-3" title="3">        <span class="bu">print</span>(<span class="ss">f&#39;Loss: </span><span class="sc">{</span>test_loss<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb9-4" title="4">        <span class="bu">print</span>(<span class="ss">f&#39;Accuracy: </span><span class="sc">{</span>test_acc<span class="sc">}</span><span class="ss">&#39;</span>)</a>
<a class="sourceLine" id="cb9-5" title="5"></a>
<a class="sourceLine" id="cb9-6" title="6">        plt.plot(<span class="va">self</span>.history.history[<span class="st">&#39;accuracy&#39;</span>], label<span class="op">=</span><span class="st">&#39;accuracy&#39;</span>)</a>
<a class="sourceLine" id="cb9-7" title="7">        plt.plot(<span class="va">self</span>.history.history[<span class="st">&#39;val_accuracy&#39;</span>], label<span class="op">=</span><span class="st">&#39;val_accuracy&#39;</span>)</a>
<a class="sourceLine" id="cb9-8" title="8">        plt.xlabel(<span class="st">&#39;Epoch&#39;</span>)</a>
<a class="sourceLine" id="cb9-9" title="9">        plt.ylabel(<span class="st">&#39;Accuracy&#39;</span>)</a>
<a class="sourceLine" id="cb9-10" title="10">        plt.ylim([<span class="fl">0.5</span>, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb9-11" title="11">        plt.legend(loc<span class="op">=</span><span class="st">&#39;lower right&#39;</span>)</a>
<a class="sourceLine" id="cb9-12" title="12">        plt.show()</a></code></pre></div>
<p>The output:</p>
<pre><code>Loss: 0.8582513928413391
Accuracy: 0.7103999853134155</code></pre>
<p><img src="history.png" /></p>
<p><br />
</p>
<p>This is where the tutorial ends, but I am taking it a step further by adding a <code>make_predictions</code> method to see how the model performs. I will be re-using the <code>make_predictions</code> code from <a href="/programming/python/tensorflow/basic-image-classification">basic image classification</a>. Please refer to the basic image classification blog for a more detailed explanation of the code below.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb11-1" title="1">    <span class="kw">def</span> plot_img(<span class="va">self</span>, prediction, actual_label, img):</a>
<a class="sourceLine" id="cb11-2" title="2">        plt.grid(<span class="va">False</span>)</a>
<a class="sourceLine" id="cb11-3" title="3">        plt.xticks([])</a>
<a class="sourceLine" id="cb11-4" title="4">        plt.yticks([])</a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6">        plt.imshow(img, cmap<span class="op">=</span>plt.cm.binary)</a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">        predicted_label <span class="op">=</span> np.argmax(prediction)</a>
<a class="sourceLine" id="cb11-9" title="9">        <span class="cf">if</span> predicted_label <span class="op">==</span> actual_label:</a>
<a class="sourceLine" id="cb11-10" title="10">            color <span class="op">=</span> <span class="st">&#39;blue&#39;</span></a>
<a class="sourceLine" id="cb11-11" title="11">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb11-12" title="12">            color <span class="op">=</span> <span class="st">&#39;red&#39;</span></a>
<a class="sourceLine" id="cb11-13" title="13"></a>
<a class="sourceLine" id="cb11-14" title="14">        predicted_class <span class="op">=</span> <span class="va">self</span>.classes[predicted_label]</a>
<a class="sourceLine" id="cb11-15" title="15">        confidence <span class="op">=</span> <span class="dv">100</span><span class="op">*</span>np.<span class="bu">max</span>(prediction)</a>
<a class="sourceLine" id="cb11-16" title="16">        actual_class <span class="op">=</span> <span class="va">self</span>.classes[actual_label]</a>
<a class="sourceLine" id="cb11-17" title="17"></a>
<a class="sourceLine" id="cb11-18" title="18">        plt.xlabel(<span class="ss">f&#39;</span><span class="sc">{</span>predicted_class<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>confidence <span class="sc">:2.0f}</span><span class="ss">% (</span><span class="sc">{</span>actual_class<span class="sc">}</span><span class="ss">)&#39;</span>, color<span class="op">=</span>color)</a>
<a class="sourceLine" id="cb11-19" title="19"></a>
<a class="sourceLine" id="cb11-20" title="20">    <span class="kw">def</span> plot_predictions(<span class="va">self</span>, prediction, actual_label):</a>
<a class="sourceLine" id="cb11-21" title="21">        plt.grid(<span class="va">False</span>)</a>
<a class="sourceLine" id="cb11-22" title="22">        plt.xticks(<span class="bu">range</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb11-23" title="23">        plt.yticks([])</a>
<a class="sourceLine" id="cb11-24" title="24">        thisplot <span class="op">=</span> plt.bar(<span class="bu">range</span>(<span class="dv">10</span>), prediction, color<span class="op">=</span><span class="st">&quot;#777777&quot;</span>)</a>
<a class="sourceLine" id="cb11-25" title="25">        plt.ylim([<span class="dv">0</span>, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb11-26" title="26">        predicted_label <span class="op">=</span> np.argmax(prediction)</a>
<a class="sourceLine" id="cb11-27" title="27"></a>
<a class="sourceLine" id="cb11-28" title="28">        thisplot[predicted_label].set_color(<span class="st">&#39;red&#39;</span>)</a>
<a class="sourceLine" id="cb11-29" title="29">        thisplot[actual_label].set_color(<span class="st">&#39;blue&#39;</span>)</a>
<a class="sourceLine" id="cb11-30" title="30"></a>
<a class="sourceLine" id="cb11-31" title="31">    <span class="kw">def</span> make_prediction(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb11-32" title="32">        prob_model <span class="op">=</span> keras.Sequential([</a>
<a class="sourceLine" id="cb11-33" title="33">            <span class="va">self</span>.model,</a>
<a class="sourceLine" id="cb11-34" title="34">            layers.Softmax()</a>
<a class="sourceLine" id="cb11-35" title="35">        ])</a>
<a class="sourceLine" id="cb11-36" title="36"></a>
<a class="sourceLine" id="cb11-37" title="37">        predictions <span class="op">=</span> prob_model.predict(<span class="va">self</span>.test_imgs)</a>
<a class="sourceLine" id="cb11-38" title="38"></a>
<a class="sourceLine" id="cb11-39" title="39">        num_rows <span class="op">=</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb11-40" title="40">        num_cols <span class="op">=</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb11-41" title="41">        num_images <span class="op">=</span> num_rows<span class="op">*</span>num_cols</a>
<a class="sourceLine" id="cb11-42" title="42">        plt.figure(figsize<span class="op">=</span>(<span class="dv">2</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span>num_cols, <span class="dv">2</span><span class="op">*</span>num_rows))</a>
<a class="sourceLine" id="cb11-43" title="43">        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_images):</a>
<a class="sourceLine" id="cb11-44" title="44">            plt.subplot(num_rows, <span class="dv">2</span><span class="op">*</span>num_cols, <span class="dv">2</span><span class="op">*</span>i<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb11-45" title="45">            prediction, actual_label, img <span class="op">=</span> predictions[i], <span class="va">self</span>.test_labels[i][<span class="dv">0</span>], <span class="va">self</span>.test_imgs[i]</a>
<a class="sourceLine" id="cb11-46" title="46">            <span class="va">self</span>.plot_img(prediction, actual_label, img)</a>
<a class="sourceLine" id="cb11-47" title="47">            plt.subplot(num_rows, <span class="dv">2</span><span class="op">*</span>num_cols, <span class="dv">2</span><span class="op">*</span>i<span class="op">+</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-48" title="48">            <span class="va">self</span>.plot_predictions(prediction, actual_label)</a>
<a class="sourceLine" id="cb11-49" title="49">        plt.tight_layout()</a>
<a class="sourceLine" id="cb11-50" title="50">        plt.show()</a></code></pre></div>
<p>The output:</p>
<p><img src="predictions.png" /></p>
<p>As we can see the model did quite well!</p>
		</main>
		<br>
		<br>
		<footer>
			<p>
				2020 OGLinuk (<a href="https://github.com/OGLinuk">GitHub</a> | <a href="https://gitlab.com/OGLinuk">GitLab</a>)
				~
				Licensed under Creative Commons Attribution-ShareAlike.
			</p>
		</footer>
		<script src="/static/main.js"></script>
	</body>

</html>